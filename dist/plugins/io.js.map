{"version":3,"sources":["../src/plugins/io.ts"],"names":["fastify_plugin_1","__importDefault","require","socket_io_1","exports","default","__awaiter","io","Server","fastify","server","cors","origin","decorate","on","console","log","socket","msg","emit"],"mappings":"sdACA,IAAAA,iBAAAC,gBAAAC,QAAA,gBAAA,CAAA,EAEAC,YAAAD,QAAA,WAAA,EAEAE,QAAAC,SAAe,EAAAL,iBAAAK,SAAG,GAAmCC,UAAA,KAAA,EAAA,KAAA,EAAA,KAAA,EAAA,YACnD,IAAMC,EAAK,IAAIJ,YAAAK,OAAeC,EAAQC,OAAQ,CAC5CC,KAAM,CACJC,OAAQ,G,EAEX,EAGDH,EAAQI,SAAS,KAAMN,CAAE,EAEzBA,EAAGO,GAAG,aAAc,IAClBC,QAAQC,IAAI,kBAAkB,EAG9BC,EAAOH,GAAG,eAAgB,IACxBC,QAAQC,IAAI,mBAAoBE,CAAG,EAGnCX,EAAGY,KAAK,eAAgBD,CAAG,CAC7B,CAAC,EAEDD,EAAOH,GAAG,aAAc,KACtBC,QAAQC,IAAI,qBAAqB,CACnC,CAAC,CACH,CAAC,CACH,CAAC,CAAA","file":"io.js","sourcesContent":["// plugins/io.ts\r\nimport fp from \"fastify-plugin\";\r\nimport { FastifyInstance } from \"fastify\";\r\nimport { Server as SocketIOServer, Socket } from \"socket.io\";\r\n\r\nexport default fp(async (fastify: FastifyInstance) => {\r\n  const io = new SocketIOServer(fastify.server, {\r\n    cors: {\r\n      origin: \"*\", // à¸›à¸£à¸±à¸šà¸•à¸²à¸¡à¸•à¹‰à¸­à¸‡à¸à¸²à¸£\r\n    },\r\n  });\r\n\r\n  // à¸œà¸¹à¸ socket.io à¹€à¸‚à¹‰à¸²à¸à¸±à¸š fastify instance\r\n  fastify.decorate(\"io\", io);\r\n\r\n  io.on(\"connection\", (socket: Socket) => {\r\n    console.log(\"A user connected\");\r\n\r\n    // à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡: à¸£à¸±à¸šà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸ client\r\n    socket.on(\"chat message\", (msg) => {\r\n      console.log(\"ðŸ“© Chat message:\", msg);\r\n\r\n      // à¸ªà¹ˆà¸‡à¸à¸¥à¸±à¸šà¹„à¸›à¸¢à¸±à¸‡à¸—à¸¸à¸ client à¸—à¸µà¹ˆà¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­\r\n      io.emit(\"chat message\", msg);\r\n    });\r\n\r\n    socket.on(\"disconnect\", () => {\r\n      console.log(\"A user disconnected\");\r\n    });\r\n  });\r\n});\r\n"]}