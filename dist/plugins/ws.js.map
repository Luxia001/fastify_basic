{"version":3,"sources":["../src/plugins/ws.ts"],"names":["fastify_plugin_1","__importDefault","require","exports","default","__awaiter","wss","Server","server","fastify","path","decorate","on","console","log","ws","clients","forEach","client","readyState","send","message","addHook","instance","done","close"],"mappings":"sdAAA,IAAAA,iBAAAC,gBAAAC,QAAA,gBAAA,CAAA,EAGAC,QAAAC,SAAe,EAAAJ,iBAAAI,SAAG,GAAmCC,UAAA,KAAA,EAAA,KAAA,EAAA,KAAA,EAAA,YAOnD,IAAMC,EAAM,IANYJ,QAAQ,IAAI,EAAEK,QACf,CACrBC,OAAQC,EAAQD,OAChBE,KAAM,K,CAGiC,EAEzCD,EAAQE,SAAS,KAAML,CAAG,EAE1BA,EAAIM,GAAG,aAAc,IACnBC,QAAQC,IAAI,cAAc,EAC1BC,EAAGH,GAAG,UAAW,IACfN,EAAIU,QAAQC,QAAQ,IACQ,IAAtBC,EAAOC,YACTD,EAAOE,KAAK,4BAA8BC,CAAO,CAErD,CAAC,CACH,CAAC,CACH,CAAC,EAEDZ,EAAQa,QAAQ,UAAW,CAACC,EAAUC,KACpClB,EAAImB,MAAMD,CAAI,EACdA,EAAI,CACN,CAAC,CACH,CAAC,CAAA","file":"ws.js","sourcesContent":["import fp from \"fastify-plugin\";\r\nimport { FastifyInstance, FastifyRequest, FastifyReply } from \"fastify\";\r\n\r\nexport default fp(async (fastify: FastifyInstance) => {\r\n  const webSocketServer = require(\"ws\").Server;\r\n  const wsOptions: any = {\r\n    server: fastify.server,\r\n    path: \"/ws\",\r\n  };\r\n\r\n  const wss = new webSocketServer(wsOptions);\r\n\r\n  fastify.decorate(\"ws\", wss);\r\n\r\n  wss.on(\"connection\", (ws: any) => {\r\n    console.log(\"connectioned\");\r\n    ws.on(\"message\", (message: any) => {\r\n      wss.clients.forEach((client: any) => {\r\n        if (client.readyState === 1) {\r\n          client.send(\"hi from wildcard route : \" + message);\r\n        }\r\n      });\r\n    });\r\n  });\r\n\r\n  fastify.addHook(\"onClose\", (instance, done) => {\r\n    wss.close(done);\r\n    done();\r\n  });\r\n});\r\n"]}